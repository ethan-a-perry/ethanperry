@layer reset, base, layout, components, utilities, pages;

@import "reset.css" layer(reset);

@layer base {
    :root {
        --heading-font: 'freight-sans-pro';
        --content-font: 'minion-pro';

        --font-size-base: 1rem;
        --font-size-body: 1.25rem;
        --font-size-s: .95rem;
        --font-size-xs: .85rem;

        --font-size-4: 1.25rem;
        --font-size-3: 1.375rem;
        --font-size-2: 1.7rem;
        --font-size-1: 2rem;

        /*--color-site-background: hsl(51, 41%, 97%);*/
        --color-site-background: white;

        --color-text-100: hsl(0, 0%, 10%);
        --color-text-80: hsl(0, 0%, 20%);
        --color-text-65: hsl(0, 0%, 30%);
        --color-text-50: hsl(0, 0%, 41%);
        --color-text-35: hsl(0, 0%, 60%);
        --color-text-20: hsl(0, 0%, 85%);
        --color-text-10: hsl(0, 0%, 78%);

        --_color-accent: 210, 80%, 40%;
        --color-accent-100: hsla(var(--_color-accent), 1);
        --color-accent-70: hsla(var(--_color-accent), 0.7);
        --color-accent-40: hsla(var(--_color-accent), 0.4);
        --color-accent-25: hsla(var(--_color-accent), 0.25);
        --color-accent-15: hsla(var(--_color-accent), 0.15);
        --color-accent-15-rgb: rgb(221, 228, 235);
        --color-accent-5: hsla(var(--_color-accent), 0.05);

        --_color-accent-secondary: 10, 55%, 45%;
        --color-accent-secondary-15: hsla(var(--_color-accent-secondary), 0.15);
        --color-accent-secondary-30: hsla(var(--_color-accent-secondary), 0.3);
        --color-accent-secondary-100: hsla(var(--_color-accent-secondary), 1);
    }

    /* Fonts */
    body {
        font-family: var(--heading-font), serif;
        font-weight: 400;
        font-style: normal;
        font-size: var(--font-size-body);
        line-height: 1.5;

        overflow-x: hidden;

        background: var(--color-site-background);
    }

    h1, .h1, h2, .h2, h3, .h3, h4, .h4, a, form, label, input, select {
        font-family: var(--heading-font), sans-serif;
        font-weight: 500;
        font-style: normal;
    }

    .caption {
        font-family: var(--caption-font), serif;
    }

    /* Font Sizes */
    h1, .h1 {
        --font-size: var(--font-size-1);
        font-size: var(--font-size);
        --font-size-diff: 0.3;
    }

    h2, .h2 {
        --font-size: var(--font-size-2);
        font-size: var(--font-size);
    }

    h3, .h3 {
        --font-size: var(--font-size-3);
        font-size: var(--font-size);
    }

    h4, .h4 {
        --font-size: var(--font-size-4);
        font-size: var(--font-size);
    }

    .fs-s {
        font-size: var(--font-size-s);
    }

    .fs-xs {
        font-size: var(--font-size-xs);
    }

    .fluid-type {
        font-size: clamp(1rem, 4cqi, 3rem);
    }

    @supports (font-size: 1cqi) {
        :is(h1, .h1, h2, .h2, h3, .h3, h4, .h4, .fluid-type) {
            --_font-min: calc(var(--font-size) - var(--font-size) * var(--font-size-diff, 0.3));

            font-size: clamp(
                    max(var(--font-size-body), var(--_font-min)),
                    var(--_font-min) + 1cqi,
                    var(--font-size)
            );
        }
    }
}

@layer layout {
    @layer content-grid {
        .content-grid {
            --padding-inline: 2rem;
            --content-max-width: 1200px;
            --breakout-max-width: 1200px;

            --breakout-size: calc((var(--breakout-max-width) - var(--content-max-width)) / 2);

            display: grid;
            grid-template-columns:
                [full-width-start] minmax(var(--padding-inline), 1fr)
                [breakout-start] minmax(0, var(--breakout-size))
                [content-start] min(100% - (var(--padding-inline) * 2), var(--content-max-width)) [content-end]
                minmax(0, var(--breakout-size)) [breakout-end]
                minmax(var(--padding-inline), 1fr) [full-width-end];
            /*row-gap: 8rem;*/
        }

        .content-grid > :not(.breakout, .full-width),
        .full-width > :not(.breakout, .full-width) {
            grid-column: content;
        }

        .content-grid > .breakout {
            grid-column: breakout;
        }

        .content-grid > .full-width {
            grid-column: full-width;

            display: grid;
            grid-template-columns: inherit;
        }
    }

    @layer dual-column {
        .dual-column {
            container: dual-column inline-size;

            display: grid;
            gap: 4rem;

            @container (width > 768px) {
                grid-template-columns: 30% 70%;
                gap: 1rem;

                > :only-child {
                    grid-column: 2;
                }

                &.with-dot::before {
                    content: "";
                    display: block;

                    width: 10px;
                    height: 10px;

                    margin-left: 0.5rem;

                    border-radius: 50%;

                    margin-bottom: 6rem;
                }

                &.with-dot.blue::before {
                    background-color: var(--color-accent-25);
                }

                &   .with-dot.grey::before {
                    background-color: var(--color-text-10);
                }
            }
        }
    }

    @layer control {
        .control {
            display: grid;
            gap: 3rem;

            @media (width > 850px) {
                grid-template-columns: 12rem minmax(0, min(80ch, 100%));
            }
        }
    }

    @layer content-tree {
        .content-tree {
            --_color: var(--color-accent-15-rgb);
        }

        .content-tree--node {
            anchor-scope: --base;

            .anchor {
                anchor-name: --base;
            }

            .target {
                anchor-scope: --target;
                anchor-name: --target;
            }

            .target::before {
                content: "";
                position: absolute;

                top: anchor(--base bottom);
                right: calc(anchor(--target left) + 5px);
                bottom: anchor(--target center);
                left: calc(anchor(--base left) + 0.5rem);

                border-left: 2px solid var(--_color);
                border-bottom: 2px solid var(--_color);
                border-bottom-left-radius: 20px;
            }
        }
    }
}

@layer utilities {
    .italic {
        font-style: italic;
    }

    .color-text-35 {
        color: var(--color-text-35);
    }

    .color-text-65 {
        color: var(--color-text-65);
    }

    .color-accent-70 {
        color: var(--color-accent-70);
    }

    .color-accent-secondary-100 {
        color: var(--color-accent-secondary-100);
    }

    .flow-2 * + * {
        margin-top: 2rem;
    }

    .flex {
        display: flex;
        align-items: center;
    }

    .flex-col-1 {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .flex-col-2 {
        display: flex;
        flex-direction: column;
        gap: 2rem;
    }

    .flex-row--5 {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .flex-row-1 {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .flex-row-2 {
        display: flex;
        align-items: center;
        gap: 2rem;
    }

    .flex-wrap {
        display: flex;
        flex-wrap: wrap;
    }

    .flow--5 * + * {
        margin-top: 0.5rem;
    }

    .ul-flow {
        display: flex;
        flex-direction: column;
        gap: 1rem;

        *> * + * {
            margin-top: 0.5rem;
        }
    }

    .margin-top-2 {
        margin-top: 2rem;
    }

    .margin-top-8 {
        margin-top: 8rem;
    }

    .margin-top-12 {
        margin-top: 12rem;
    }

    .grid-span-all {
        grid-column: 1 / -1;
    }

    .ellipsis {
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
    }

    .with-border-top {
        margin-top: 1rem;
        border-top: 1px solid var(--color-text-10);
        padding-top: 1rem;
    }

    .theme-grey {
        background-color: rgb(245, 245, 245);

        padding: 1rem 1.5rem;

        p {
            color: var(--color-text-65);

        }

        span {
            color: var(--color-text-35);
        }
    }

    .scroller {
        overflow: scroll;

        /* Hide scrollbar in Firefox */
        scrollbar-width: none;

        /* Hide scrollbar in IE/Edge */
        -ms-overflow-style: none;

        /* Hide scrollbar in Chrome and Safari */

        &::-webkit-scrollbar {
            display: none;
        }

        &.vert {
            mask: linear-gradient(to bottom, transparent 0%, black 10%, black 50%, transparent 100%) no-repeat 0 / 100% 100%;
            -webkit-mask: -webkit-linear-gradient(to bottom, transparent 0%, black 5px, black 90%, transparent 100%) no-repeat 0 / 100% 100%;
        }

        &.horiz {
            mask: linear-gradient(to right, black 90%, transparent 100%) no-repeat 0 / 100% 100%;
            -webkit-mask: -webkit-linear-gradient(to right, transparent 0%, black 5px, black 90%, transparent 100%) no-repeat 0 / 100% 100%;
        }
    }
}

@layer pages {
    @layer home {}

    @layer work {
        .works {
            container: works / inline-size;

            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .work {
            font-family: var(--heading-font), sans-serif;
            background: rgb(245, 245, 245);

            padding: 1rem 1.5rem;

            display: inline-grid;
            grid-template-columns: 1fr min(300px, 100%);
            gap: 2rem;

            img {
                height: 100%;
                aspect-ratio: 1;
                align-self: center;
                object-fit: cover;
            }
        }

        .work--info {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            gap: 2rem;

            p {
                color: var(--color-text-65);
            }
        }

        .work--details {
            color: var(--color-text-35);

            display: grid;
            grid-template-columns: 1fr auto;
            gap: 1rem;

            ul {
                display: flex;
                align-items: center;
                gap: 1ch;

                &::before {
                    content: "";
                    width: 6px;
                    height: 6px;

                    aspect-ratio: 1;

                    border: 1px solid currentColor;
                    border-radius: 50%;
                }
            }
        }

        @container works (width < calc(1.5rem + 250px + 2rem + 300px + 1.5rem)) {
            .work {
                grid-template-columns: 1fr;
                justify-items: center;

                max-width: min(450px, 100%);

                img {
                    height: 300px;
                    width: 100%;
                }

                .view {
                    display: none;
                }
            }
        }
    }

    @layer writings {
        .writing--date {
            align-self: flex-start;
        }

        .writing--tags {
            margin-left: 0.5em;
        }
    }

    @layer writings-post {
        .post-wrapper {
            display: grid;
            grid-template-columns: min(70ch, 100%);
            gap: 2rem;

            /*container-name: post-wrapper;*/

            @container (width > calc(50ch + 30ch + 11rem)) {
                grid-template-columns: minmax(50ch, 75ch) minmax(30ch, 1fr);
                gap: 7rem;

                .post-sidebar {
                    border-top: 0;
                    border-left: 1px solid var(--color-text-20);
                    padding: 1rem 0 1rem 2rem;
                }
            }
        }

        .post {
            display: grid;
            gap: 4rem;
        }

        .post-content {

        }

        .post-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;

            color: var(--color-accent-secondary-100);
        }

        .post-nav .disabled {
            text-decoration: line-through;
            cursor: not-allowed;
        }

        .post-nav a {
            anchor-scope: --post-nav-a;
            anchor-name: --post-nav-a;

            padding-bottom: 1rem;

            &:hover {
                &::before, &::after {
                    display: block;
                    opacity: 1;

                    @starting-style {
                        opacity: 0;
                    }
                }
            }

            &::before, &::after {
                z-index: 999;

                background-color: var(--color-accent-15);

                display: none;
                opacity: 0;

                transition: display 0.3s, opacity 0.3s;
                transition-behavior: allow-discrete;
            }

            &::before {
                content: attr(data-tooltip, "");
                position: absolute;

                position-anchor: --post-nav-a;
                top: anchor(--post-nav-a bottom);
                justify-self: anchor-center;

                width: max-content;

                margin-inline: 1rem;
                padding: 7px 12px;

                border-radius: 5px;

                color: var(--color-text-65);

            }

            &::after {
                content: "";
                position: absolute;

                position-anchor: --post-nav-a;
                bottom: anchor(--post-nav-a bottom);
                justify-self: anchor-center;

                width: 30px;
                height: 30px;

                clip-path: polygon(75% 100%, 25% 100%, 50% 75%);
            }
        }

        .post-sidebar {
            display: flex;
            flex-direction: column;
            gap: 2rem;

            border-top: 1px solid var(--color-text-20);
            padding-top: 2rem;

            color: var(--color-text-65);

            @container (width > calc(50ch + 30ch + 11rem)) {

            }
        }

        .sidebar-posts {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            font-size: var(--font-size-base);
        }

        .sidebar-post-date {
            margin-left: 0.5rem;
        }

        .posts > li {
            margin-top: 1.5rem;
            margin-left: 2.5rem;
        }

        summary {
            position: relative;
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;

            margin: 0;
            padding: 6px 12px;

            border: 0;
            border-radius: 5px;

            background: var(--color-accent-15-rgb);

            cursor: pointer;
        }

        summary::marker {
            content: none;
        }

        summary::after {
            content: '';
            display: inline-block;
            width: 16px;
            height: 16px;
            background-size: contain;
            background-repeat: no-repeat;
            background-image: url("/public/assets/icons/chevron-right.svg");
        }

        details[open] summary::after {
            transform: rotate(90deg);
        }
    }

    @layer about {
        .with-about-border {
            padding-top: 2rem;
            margin-top: 2rem;
            border-top: 1px solid var(--color-text-10);

            /*@media (width > 768px) {*/
            /*    padding-top: 6rem;*/
            /*}*/
        }

        .about--images {
            display: grid;
            gap: 1rem;

            width: min(900px, 100%);

            @media (width > 768px) {
                grid-template-columns: 1fr 1fr;
            }
        }

        .cv {
            display: grid;
            gap: 4rem;
        }

        .company {
            container-type: inline-size;

            --size: attr(data-col-size type(<length>), 1fr);
            display: grid;
            gap: 2rem;

            @container (width > 850px) {
                grid-template-columns: 10% 1fr;
                gap: 6rem;
            }

            h3, h4 {
                color: var(--color-accent-100);
            }

            .roles {
                display: grid;
                gap: 2rem;
            }

            p {
                font-family: var(--heading-font), sans-serif;
            }
        }

        .role {
            color: var(--color-text-65);
            display: grid;
            gap: 1rem;
        }

        .role--tags {
            font-family: var(--heading-font), sans-serif;

            li {
                display: inline;
            }
        }

        .role--tags li:not(:last-child)::after, .date::before {
            content: " \00b7";
            margin-inline: 1ch;
        }
    }

    @layer contact {
        .contact {
            display: flex;
            flex-direction: column;

            gap: 4rem;

            ul {
                display: flex;
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;

                color: var(--color-text-65);
            }
        }

        @layer components {
            @layer form {
                .form--wrapper {
                    width: min(600px, 100%);
                }

                form {
                    display: grid;
                    gap: 2rem;

                    color: var(--color-text-65);
                }

                .form-group {
                    display: grid;
                    gap: 0.25rem;

                    &:has([required]) label {
                        display: flex;
                        gap: 1ch;

                        &::after {
                            content: "*";
                            color: var(--color-accent-100);
                        }
                    }
                }

                input, textarea {
                    padding: 0.75em 1em;

                    border: 1px solid var(--color-text-50);
                    border-radius: 5px;

                    background: transparent;

                    outline: none;
                    accent-color: var(--color-accent-40);

                    transition: box-shadow 0.2s ease;

                    &:focus-visible {
                        box-shadow: 6px 6px 0 var(--color-accent-40);
                    }
                }

                textarea {
                    box-sizing: content-box;
                    resize: vertical;
                    min-block-size: 3lh;
                }

                form button {
                    cursor: pointer;

                    padding: 1em 1.5em;

                    border: 0;
                    border-radius: 16px;

                    background-color: var(--color-accent-15);
                    color: var(--color-text-65);

                    &:hover,
                    &:focus-visible {
                        background-color: var(--color-accent-40);
                    }
                }
            }
        }
    }

    @layer sitemap {
        .sitemap {
            display: grid;
            gap: 6rem;

            > li {
                display: grid;
                grid-template-columns: 100px 1fr;
                gap: 2rem;

                ul {
                    display: flex;
                    flex-direction: column;
                    gap: 0.5rem;
                }
            }

            p {
                color: var(--color-accent-100);
            }

            a {
                font-weight: 400;
            }

            .may-scroll {
                max-height: 400px;
            }
        }
    }

    @layer error {
        .error {
            display: grid;
            gap: 2rem;

            & h1 {
                color: var(--color-accent-secondary-100);
            }
        }
    }
}