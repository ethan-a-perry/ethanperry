---
import Post from '../../layouts/Post.astro'

import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
    const posts = (await getCollection('writings')).sort((a, b) => b.data.datePublished.valueOf() - a.data.datePublished.valueOf());

    return posts.map((post, index) => {
        const previousPost = index > 0 ? posts[index - 1] : undefined;
        const nextPost = index < posts.length - 1 ? posts[index + 1] : undefined;

        return {
            params: { slug: post.id },
            props: {
                post,
                previousPost: previousPost
                    ? {
                        id: `/writings/${previousPost.id}`,
                        title: previousPost.data.title,
                    }
                    : undefined,
                nextPost: nextPost
                    ? {
                        id: `/writings/${nextPost.id}`,
                        title: nextPost.data.title,
                    }
                    : undefined
            },
        };
    });
}

const { post, previousPost, nextPost } = Astro.props;
const { Content } = await render(post);
---

<Post frontmatter={post.data} previousPost={previousPost} nextPost={nextPost}>
    <Content />
</Post>
